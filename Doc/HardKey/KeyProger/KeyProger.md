<p align="left">
<h2 align="center">Настройка USB ключа.</h2>
</p>
<p>
Для создания аппаратного ключа потребуется плата с микроконтроллером stm32f103c8t6. 
Подобная плата обычно имеет название «stm32 blue pill» или «отладочная плата STM32». Важно купить плату с оригинальным микроконтроллером от фирмы st microelectronics. Так как существует достаточно много копий с китайским ARM.<br>
<img src="./Stm32Board.jpg" width="50%">
</p>
<p>
Скачиваем IDE Keil v5.36. Собираем прошивку из \HardwareProjects\STM32UsbKey.
Или берем готовую из \Binaries\STM32UsbKeyFirmware.zip. Прошиваем микроконтроллер.
</p>
<p>
Генерируем ключ RSA, которым микроконтроллер будет шифровать сеансовый ключ.
Для этого из Git Bash запускаем \Native\HardwareKeyExample\KeyProger\genkey.bat.
Git Bash знает где лежит openssl, поэтому используем его.<br>
<img src="./GitBash.jpg" width="70%">
</p>
<p>
В .bat файле указано:<br>
Генерация RSA ключа длиной 2048 бит, и помещение его в .pem контейнер.<br>
Конвертируем ключ из формата .pem в pkc8.<br>
Удаление ключа в формате pem.<br>
</p>
<p>
Для загрузки серийного номера и ключа RSA в флеш память микроконтроллера, используется программа «KeyProger».
Исходники можно найти в \Native\HardwareKeyExample\KeyProger
</p>
<p>
После запуска – возможен выбор двух режимов.<br>
<img src="./MainWindow.jpg" width="50%">
</p>
<p>
Режим «простого пользователя» позволяет загрузить серийный номер и ключ RSA:<br>
<img src="./EasyMode.jpg" width="50%">
</p>
<p>
Для входа в режим «эксперт» потребуется ввести пароль, прописанный в файле \Native\HardwareKeyExample\KeyProger\config.h<br>
<img src="./EnableExpert.jpg" width="50%">
</p>
<p>
Режим «зксперт» позволяет получить все данные:<br>
<img src="./ExpertMode.jpg" width="50%">
</p>
<p>
Для загрузки RSA ключа необходимо нажать «LoadNewRSAKey».<br>
</p>
<p>
Программа считывает файл prkey (полученный в предыдущих шагах и находящийся в корне проекта KeyProger).
Создаст uVectors.h, в корне защищаемой программы(KeyDistributionCenter). uVectors.h – содержит закодированный специальным алгоритмом ключ rsa в виде бинарного массива. Массив вшивается в защищаемую программу при сборке.
Далее из prkey считывается модуль n алгоритма rsa длиной 256 байт. Модуль отправляется микроконтроллеру, который зашивает его во флеш память.
</p>